{% load static %}

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Invoice #{{ order.id }}</title>
    <style>
        {# 
          This @page rule sets the standard A4 size and margins for when the document is printed or saved as a PDF. 
        #}
        @page { size: A4; margin: 1.5cm; }

        body { font-family: sans-serif; color: #333; font-size: 12px; line-height: 1.6; }
        .container { width: 100%; margin: 0 auto; }
        
        {# Styles for the header section, containing the logo and invoice details #}
        .header-table { width: 100%; margin-bottom: 40px; border-collapse: collapse; }
        .header-table td { padding: 0; vertical-align: top; }
        .shop-logo img { max-width: 150px; }
        .invoice-info { text-align: right; }
        .invoice-info h2 { font-size: 28px; margin: 0; font-weight: bold; color: #333; }
        .invoice-info p { margin: 2px 0; font-size: 11px; color: #555; }
        
        {# Styles for the customer's billing information box #}
        .customer-info { margin-bottom: 30px; padding: 15px; background-color: #f9f9f9; border: 1px solid #eee; border-radius: 5px; }
        
        {# Styles for the main table that lists the purchased items #}
        .items-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        .items-table th, .items-table td { border-bottom: 1px solid #ddd; padding: 12px 15px; text-align: left; }
        .items-table thead th { background-color: #f2f2f2; font-weight: bold; padding: 10px 15px; }
        .items-table .text-right { text-align: right; }
        
        {# Styles for the final totals section #}
        .totals { float: right; width: 45%; }
        .totals table { width: 100%; }
        .totals td { padding: 8px 15px; }
        .totals .label { font-weight: bold; color: #555; }
        .totals .grand-total { border-top: 2px solid #333; font-weight: bold; font-size: 1.3em; }
        
        {# This positions the footer at the bottom of each page in the PDF #}
        .footer { position: fixed; bottom: -1cm; left: 0; right: 0; text-align: center; font-size: 10px; color: #888; }
    </style>
</head>
<body>
    {# The footer will appear at the bottom of every page of the generated PDF. #}
    <div class="footer">
        <p>Thank you for your order! | Plant Shop | support@myshop.com</p>
    </div>

    <div class="container">
        {# START: Invoice Header #}
        <table class="header-table">
            <tr>
                <td class="shop-logo">
                    {# The logo is loaded from your static files directory. #}
                    <img src="{% static 'img/core-img/logo.png' %}" alt="Plant Shop Logo">
                </td>
                <td class="invoice-info">
                    <h2>INVOICE</h2>
                    <p><strong>Invoice #:</strong> {{ order.id }}</p>
                    <p><strong>Date:</strong> {{ order.created_at|date:"F d, Y" }}</p>
                    <p><strong>Status:</strong> Paid (Cash on Delivery)</p>
                </td>
            </tr>
        </table>
        {# END: Invoice Header #}
        
        {# START: Customer Billing Information #}
        <div class="customer-info">
            <strong>Bill To:</strong><br>
            {{ order.full_name }}<br>
            {{ order.address }}, {{ order.city }}, {{ order.state }} - {{ order.postcode }}<br>
            {{ order.email }}
        </div>
        {# END: Customer Billing Information #}

        {# START: Table of Purchased Items #}
        <table class="items-table">
            <thead>
                <tr>
                    <th>Item Description</th>
                    <th class="text-right">Quantity</th>
                    <th class="text-right">Unit Price</th>
                    <th class="text-right">Total</th>
                </tr>
            </thead>
            <tbody>
                {# This loop iterates through all items associated with the order. #}
                {% for item in order.items.all %}
                <tr>
                    <td>{{ item.product.name }}</td>
                    <td class="text-right">{{ item.quantity }}</td>
                    <td class="text-right">₹{{ item.price|floatformat:2 }}</td>
                    <td class="text-right">₹{{ item.get_total|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {# END: Table of Purchased Items #}

        {# START: Final Totals Section #}
        <div class="totals">
            <table>
                <tr>
                    <td class="label">Subtotal:</td>
                    <td class="text-right">₹{{ order.subtotal|floatformat:2 }}</td>
                </tr>
                <tr>
                    <td class="label">Shipping:</td>
                    <td class="text-right">₹{{ order.shipping_cost|floatformat:2 }}</td>
                </tr>
                <tr class="grand-total">
                    <td class="label">Total Paid:</td>
                    <td class="text-right">₹{{ order.total_price|floatformat:2 }}</td>
                </tr>
            </table>
        </div>
        {# END: Final Totals Section #}
    </div>
</body>
</html>