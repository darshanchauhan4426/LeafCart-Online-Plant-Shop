{% extends "base.html" %}
{% load static %}

{% block title %}My Wishlist{% endblock title %}

{% block main %}
{# Main content for the Wishlist page starts here. #}

{# START: Breadcrumb Area #}
<div class="breadcrumb-area">
    <div class="top-breadcrumb-area bg-img bg-overlay d-flex align-items-center justify-content-center"
         style="background-image: url('{% static "img/bg-img/24.jpg" %}');">
        <h2>My Wishlist</h2>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'index' %}"><i class="fa fa-home"></i> Home</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Wishlist</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>
{# END: Breadcrumb Area #}

<section class="shop-page section-padding-100">
    <div class="container">
        {# This block displays any success or error messages (e.g., "Item removed from wishlist") #}
        {% if messages %}
        <div class="row">
            <div class="col-12">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="row">
            {# This is the main check. If the wishlist has items, it loops through and displays them. #}
            {% if wishlist_items %}
                {% for item in wishlist_items %}
                <div class="col-12 col-sm-6 col-lg-4">
                    <div class="single-product-area mb-50">
                        <div class="product-card">
                            <div class="product-image-container">
                                <a href="{% url 'shop_details' item.product.id %}">
                                    {# Displays the first image from the product's gallery #}
                                    {% if item.product.images.all.0 %}
                                        <img src="{{ item.product.images.all.0.image.url }}" alt="{{ item.product.name }}">
                                    {% else %}
                                        <img src="{% static 'img/no-image.png' %}" alt="No Image Available">
                                    {% endif %}
                                </a>
                            </div>
                            <div class="product-card-body">
                                <a href="{% url 'shop_details' item.product.id %}" class="product-name"><h5>{{ item.product.name }}</h5></a>
                                <div class="product-rating mb-2">
                                    {% for i in "12345" %}<i class="fa fa-star{% if item.product.average_rating < i|add:'0' %}-o{% endif %}"></i>{% endfor %}
                                    <span class="review-count"> ({{ item.product.review_count }})</span>
                                </div>
                                <p class="product-price">â‚¹{{ item.product.price|floatformat:2 }}</p>

                                {# Checks stock and shows either 'Add to Cart' or 'Out of Stock' #}
                                {% if item.product.stock > 0 %}
                                    <form action="{% url 'add_to_cart' item.product.id %}" method="post" class="mb-2">
                                        {% csrf_token %}
                                        <input type="hidden" name="quantity" value="1">
                                        <button type="submit" class="btn alazea-btn btn-sm w-100"><i class="fa fa-shopping-cart"></i> Add to Cart</button>
                                    </form>
                                {% else %}
                                    <button type="button" class="btn alazea-btn btn-sm w-100 mb-2" disabled style="background-color:#a0a0a0;border-color:#a0a0a0;">Out of Stock</button>
                                {% endif %}
                                <a href="{% url 'remove_from_wishlist' item.product.id %}" class="btn btn-outline-danger btn-sm w-100">Remove</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {# This block is shown if the wishlist_items list is empty #}
            {% else %}
                <div class="col-12 text-center">
                    <div class="empty-cart-container">
                        <img src="{% static 'img/core-img/leaf.png' %}" alt="Empty Wishlist" style="max-width: 100px; opacity: 0.5;">
                        <h4 class="mt-4">Your wishlist is empty.</h4>
                        <p>Click the heart icon on products to save them for later.</p>
                        <a href="{% url 'shop' %}" class="btn alazea-btn mt-3">Discover Products</a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</section>

{# Custom CSS styles for the product card design on this page #}
<style>
    .product-card{background:#fff;border:1px solid #ebebeb;border-radius:8px;overflow:hidden;transition:box-shadow .3s ease,transform .3s ease;display:flex;flex-direction:column;height:100%}.product-card:hover{box-shadow:0 8px 25px rgba(0,0,0,.1);transform:translateY(-5px)}.product-image-container{height:220px;overflow:hidden;position:relative}.product-image-container img{width:100%;height:100%;object-fit:cover;transition:transform .4s ease}.product-card:hover .product-image-container img{transform:scale(1.05)}.product-card-body{padding:20px;text-align:center;flex-grow:1;display:flex;flex-direction:column}.product-name h5{font-size:1rem;font-weight:600;margin-bottom:10px;color:#2a2a2a;transition:color .3s ease}.product-name:hover h5{color:#70c745}.product-rating{color:#f5a623}.review-count{font-size:.8rem;color:#777}.product-price{font-size:1.1rem;font-weight:700;color:#70c745;margin-bottom:15px;margin-top:auto}.product-card-body .btn{margin-top:10px}
</style>

{# Main content for the Wishlist page ends here. #}
{% endblock main %}