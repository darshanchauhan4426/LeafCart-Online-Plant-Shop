{% extends "base.html" %}
{% load static %}

{% block title %}Checkout{% endblock title %}

{% block main %}
{# Main content for the Checkout page starts here. #}

{# START: Breadcrumb Area #}
<div class="breadcrumb-area">
    <div class="top-breadcrumb-area bg-img bg-overlay d-flex align-items-center justify-content-center" style="background-image: url({% static 'img/bg-img/24.jpg' %});">
        <h2>Checkout</h2>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'index' %}"><i class="fa fa-home"></i> Home</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'cart_view' %}">Cart</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Checkout</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>
{# END: Breadcrumb Area #}

{# START: Main Checkout Area #}
<div class="checkout_area mb-100">
    <div class="container">
        <div class="row justify-content-between">

            {# START: Billing Details Form (Left Column) #}
            <div class="col-12 col-lg-7">
                <div class="checkout_details_area clearfix">
                    <h5>Billing Details</h5>
                    {# This form collects all the user's shipping info. #}
                      {# The id="checkout-form" links it to the "Place Order" button in the other column. #}
                    <form action="{% url 'checkout' %}" method="post" id="checkout-form">
                        {# Django's security token, required for all POST forms #}
                        {% csrf_token %}
                        <div class="row">
                            {# Form fields are pre-filled with the logged-in user's data for convenience #}
                            <div class="col-12 mb-4">
                                <label for="full_name">Full Name *</label>
                                <input type="text" class="form-control" id="full_name" name="full_name" value="{{ request.user.full_name }}" required>
                            </div>
                            <div class="col-12 mb-4">
                                <label for="email_address">Email Address *</label>
                                <input type="email" class="form-control" id="email_address" name="email" value="{{ request.user.email }}" required>
                            </div>
                            <div class="col-12 mb-4">
                                <label for="phone_number">Phone Number *</label>
                                <input type="tel" class="form-control" id="phone_number" name="phone" value="{{ request.user.phone }}" required>
                            </div>
                            <div class="col-12 mb-4">
                                <label for="address">Address *</label>
                                <input type="text" class="form-control" id="address" name="address" placeholder="Street Address" required>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="city">Town/City *</label>
                                <input type="text" class="form-control" id="city" name="city" required>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="state">State *</label>
                                <input type="text" class="form-control" id="state" name="state" required>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="postcode">Postcode/Zip *</label>
                                <input type="text" class="form-control" id="postcode" name="postcode" required>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="country">Country *</label>
                                <select class="custom-select d-block w-100" id="country" name="country" required>
                                    <option value="India" selected>India</option>
                                    <option value="USA">United States</option>
                                    <option value="UK">United Kingdom</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            {# END: Billing Details Form #}

            {# START: Order Summary (Right Column) #}
            <div class="col-12 col-lg-4">
                <div class="checkout-content">
                    <h5 class="title--">Your Order Summary</h5>
                    <div class="products">
                        <div class="products-data">
                            <div class="subtotal d-flex justify-content-between align-items-center">
                                <h6>Products</h6>
                                <h6>Total</h6>
                            </div>
                            {# Loop through items from the cart to display them in the summary #}
                            {% for item in cart_items %}
                            <div class="single-products d-flex justify-content-between align-items-center mt-2">
                                <p>{{ item.quantity }} x {{ item.product.name }}</p>
                                <h5>₹{{ item.get_total|floatformat:2 }}</h5>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <ul class="summary-list">
                        <li><span>Subtotal</span> <span>₹{{ cart_subtotal|floatformat:2 }}</span></li>
                        
                        {# This block only appears if a valid coupon has been applied #}
                        {% if discount_amount > 0 %}
                        <li class="text-success">
                            <span>Discount ({{ coupon_code }})</span>
                            <span>- ₹{{ discount_amount|floatformat:2 }}</span>
                        </li>
                        {% endif %}

                        <li><span>Shipping</span> <span>Free</span></li>
                        <li class="total"><span>Total</span> <span>₹{{ final_total|floatformat:2 }}</span></li>
                    </ul>
                    <div class="payment-method d-flex justify-content-between align-items-center">
                        <h5>Payment Method</h5>
                        <h5>Cash on Delivery</h5>
                    </div>
                    <div class="checkout-btn mt-30">
                        {# This button is outside the form, but the form="checkout-form" attribute links them together #}
                        <button type="submit" form="checkout-form" class="btn leafcart-btn w-100">Place Order</button>
                    </div>
                </div>
            </div>
            {# END: Order Summary #}
        </div>
    </div>
</div>
{# Page-specific styles for the order summary list #}
<style>
    .summary-list { list-style: none; padding: 20px 0; border-top: 1px solid #ebebeb; margin-top: 20px; }
    .summary-list li { display: flex; justify-content: space-between; margin-bottom: 15px; }
    .summary-list li.total { font-weight: bold; font-size: 1.2em; padding-top: 15px; border-top: 1px solid #ddd; }
    .payment-method { padding-bottom: 20px; border-bottom: 1px solid #ebebeb; }
</style>

{# Main content for the Checkout page ends here. #}
{% endblock main %}